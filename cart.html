<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechStore - Giỏ hàng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }</style>
</head>
<body>
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 flex justify-between items-center h-16">
            <a href="index.html" class="flex items-center gap-2 font-bold text-xl text-gray-800">
                <div class="bg-blue-600 p-2 rounded-lg text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div>
                TechStore
            </a>
            <div class="flex items-center space-x-2 md:space-x-4">
                <a href="index.html" class="px-3 py-2 rounded-md font-medium text-sm text-gray-600 hover:bg-gray-100">Sản phẩm</a>
                <a href="cart.html" class="px-3 py-2 rounded-md font-medium text-sm text-blue-600 bg-blue-100 flex gap-1 items-center">
                    Giỏ hàng <span id="cart-badge" class="bg-red-500 text-white text-xs rounded-full px-2 py-0.5 hidden">0</span>
                </a>
                <a href="orders.html" class="px-3 py-2 rounded-md font-medium text-sm text-gray-600 hover:bg-gray-100">Đơn hàng</a>
                <a href="profile.html" class="px-3 py-2 rounded-md font-medium text-sm text-gray-600 hover:bg-gray-100 flex items-center gap-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    <span class="hidden md:inline">Tài khoản</span>
                </a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 min-h-screen max-w-4xl">
        <h2 class="text-2xl font-bold mb-6">Giỏ hàng của bạn</h2>
        <div id="cart-container"></div>
    </main>

    <script>
        let cart = JSON.parse(localStorage.getItem('techstore_cart')) || [];
        let orders = JSON.parse(localStorage.getItem('techstore_orders')) || [];

        function init() { renderCart(); updateBadge(); }
        function formatMoney(n) { return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(n); }

        function renderCart() {
            const container = document.getElementById('cart-container');
            if (cart.length === 0) {
                container.innerHTML = `<div class="text-center py-10 bg-white rounded shadow text-gray-500">Giỏ hàng trống. <a href="index.html" class="text-blue-600 hover:underline">Mua sắm ngay</a></div>`;
                return;
            }
            let total = 0;
            const rows = cart.map((item, idx) => {
                total += item.price * item.qty;
                return `
                    <tr class="border-b">
                        <td class="py-4 text-gray-800">${item.name}</td>
                        <td class="py-4 text-center">${formatMoney(item.price)}</td>
                        <td class="py-4 text-center">
                            <button onclick="updateQty(${idx}, -1)" class="px-2 bg-gray-200 rounded hover:bg-gray-300">-</button>
                            <span class="mx-2">${item.qty}</span>
                            <button onclick="updateQty(${idx}, 1)" class="px-2 bg-gray-200 rounded hover:bg-gray-300">+</button>
                        </td>
                        <td class="py-4 text-right font-bold">${formatMoney(item.price * item.qty)}</td>
                        <td class="py-4 text-center text-red-500 cursor-pointer hover:underline" onclick="removeItem(${idx})">Xóa</td>
                    </tr>`;
            }).join('');

            container.innerHTML = `
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 border-b"><tr><th class="text-left py-3 px-4">Sản phẩm</th><th class="py-3 px-4">Đơn giá</th><th class="py-3 px-4">Số lượng</th><th class="text-right py-3 px-4">Thành tiền</th><th></th></tr></thead>
                        <tbody class="px-4">${rows}</tbody>
                        <tfoot class="bg-gray-50"><tr><td colspan="3" class="text-right py-4 font-bold">Tổng cộng:</td><td class="text-right py-4 font-bold text-xl text-blue-600 px-4">${formatMoney(total)}</td><td></td></tr></tfoot>
                    </table>
                </div>
                <div class="mt-6 flex justify-end gap-4">
                    <button onclick="checkout()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow transition font-medium">Thanh toán ngay</button>
                </div>`;
        }

        window.updateQty = (idx, delta) => {
            if (cart[idx].qty + delta > 0) cart[idx].qty += delta;
            else if (confirm('Xóa sản phẩm này?')) cart.splice(idx, 1);
            saveAndRender();
        };

        window.removeItem = (idx) => {
            if (confirm('Xóa sản phẩm này?')) { cart.splice(idx, 1); saveAndRender(); }
        };

        function saveAndRender() {
            localStorage.setItem('techstore_cart', JSON.stringify(cart));
            renderCart(); updateBadge();
        }

        window.checkout = () => {
            if (!confirm('Xác nhận đặt hàng?')) return;
            const total = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            const itemNames = cart.map(i => `${i.name} (x${i.qty})`).join(', ');
            
            orders.unshift({
                id: Math.floor(Math.random() * 90000) + 10000,
                date: new Date().toISOString().split('T')[0],
                status: 'Chờ xử lý',
                total: total,
                items: itemNames
            });
            localStorage.setItem('techstore_orders', JSON.stringify(orders));
            cart = [];
            localStorage.setItem('techstore_cart', JSON.stringify(cart));
            
            alert('Đặt hàng thành công!');
            window.location.href = 'orders.html';
        };

        function updateBadge() {
            const count = cart.reduce((a, b) => a + b.qty, 0);
            const el = document.getElementById('cart-badge');
            el.innerText = count;
            count > 0 ? el.classList.remove('hidden') : el.classList.add('hidden');
        }
        init();
    </script>
</body>
</html>